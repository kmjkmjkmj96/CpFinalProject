<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Approval">
	<!-- 결재 문서 저장 -->
	<insert id="insertApproval" parameterType="com.workly.final_project.approval.model.vo.Approval"
	    useGeneratedKeys="true" keyProperty="approvalNo" keyColumn="APPROVAL_NO">
	    INSERT INTO APPROVAL (APPROVAL_NO, USER_NO, APPROVAL_TYPE, APPROVAL_STATUS, APPROVAL_TITLE, APPROVAL_CONTENT, START_DATE, APPROVAL_USER)
	    VALUES (APPROVAL_SEQ.NEXTVAL, #{userNo}, #{approvalType}, 1, #{approvalTitle}, #{approvalContent}, SYSDATE, #{approvalUser})
	</insert>
	
  <select id="getAllApprovals" resultType="Approval">
	  SELECT 
        APPROVAL_NO as approvalNo,
        USER_NO as userNo,
        APPROVAL_TYPE as approvalType,
        APPROVAL_STATUS as approvalStatus,
        APPROVAL_TITLE as approvalTitle,
        APPROVAL_CONTENT as approvalContent,
        START_DATE as startDate,
        END_DATE as endDate,
        APPROVAL_USER as approvalUser,
        CREATED_AT as createdAt
    FROM APPROVAL
    ORDER BY CREATED_AT DESC
	</select>
	
	<select id="getDepartmentsWithEmployees" resultType="map">
		SELECT
			POSITION_NAME,
			DEPT_NAME,
			USER_NAME,
			USER_NO
		FROM MEMBER
		JOIN DEPARTMENT USING(DEPT_NO)
		JOIN POSITION USING(POSITION_NO)
		ORDER BY DEPT_NAME, USER_NAME
	</select>

    
</mapper>










