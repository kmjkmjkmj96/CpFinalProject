<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="calendarMapper">

    <!-- ✅ 내 일정 조회 -->
    <select id="selectMyEvents" resultType="Calendar">
        SELECT * FROM CALENDAR WHERE USER_NO = #{userNo}
    </select>

    <!-- ✅ 팀 일정 조회 -->
    <select id="selectTeamEvents" resultType="Calendar">
        SELECT * FROM CALENDAR WHERE DEPT_NO = #{deptNo}
    </select>

    <!-- ✅ 회의실 예약 일정 조회 -->
    <select id="selectMeetingEvents" resultType="Calendar">
        SELECT * FROM CALENDAR WHERE MR_RES_NO IS NOT NULL
    </select>

    <!-- ✅ 일정 추가 -->
    <insert id="insertEvent" useGeneratedKeys="true" keyProperty="calNo">
        INSERT INTO CALENDAR (CATEGORY, TITLE, CONTENT, START_DATE, END_DATE, COLOR, USER_NO, DEPT_NO, MR_RES_NO)
        VALUES (#{category}, #{title}, #{content}, #{startDate}, #{endDate}, #{color}, #{userNo}, 
            <if test="deptNo != null">#{deptNo}</if><if test="deptNo == null">NULL</if>, 
            <if test="mrResNo != null">#{mrResNo}</if><if test="mrResNo == null">NULL</if>
        )
    </insert>

    <!-- ✅ 일정 수정 -->
    <update id="updateEvent">
        UPDATE CALENDAR
        SET CATEGORY = #{category},
            TITLE = #{title},
            CONTENT = #{content},
            START_DATE = #{startDate},
            END_DATE = #{endDate},
            COLOR = #{color},
            DEPT_NO = <if test="deptNo != null">#{deptNo}</if><if test="deptNo == null">NULL</if>,
            MR_RES_NO = <if test="mrResNo != null">#{mrResNo}</if><if test="mrResNo == null">NULL</if>
        WHERE CAL_NO = #{calNo}
    </update>

    <!-- ✅ 일정 삭제 -->
    <delete id="deleteEvent">
        DELETE FROM CALENDAR WHERE CAL_NO = #{calNo}
    </delete>

    <!-- ✅ 회의실 예약 목록 조회 -->
    <select id="selectMeetingReservations" resultType="MeetingReservation">
        SELECT * FROM MR_RESERVATION
    </select>

    <!-- ✅ 회의실 예약 추가 -->
    <insert id="insertMeetingReservation" useGeneratedKeys="true" keyProperty="resNo">
        INSERT INTO MR_RESERVATION (ROOM_NO, USER_NO, START_TIME, END_TIME, TITLE, DESCRIPTION)
        VALUES (#{roomNo}, #{userNo}, #{startTime}, #{endTime}, #{title}, #{description})
    </insert>

    <!-- ✅ 회의실 예약 수정 -->
    <update id="updateMeetingReservation">
        UPDATE MR_RESERVATION
        SET ROOM_NO = #{roomNo}, START_TIME = #{startTime}, END_TIME = #{endTime}, TITLE = #{title}, DESCRIPTION = #{description}
        WHERE RES_NO = #{resNo}
    </update>

    <!-- ✅ 회의실 예약 삭제 -->
    <delete id="deleteMeetingReservation">
        DELETE FROM MR_RESERVATION WHERE RES_NO = #{resNo}
    </delete>

    <!-- ✅ 사용자 메모 조회 -->
    <select id="selectMemo" resultType="CalendarMemo">
        SELECT * FROM CALENDAR_MEMO WHERE USER_NO = #{userNo}
    </select>

    <!-- ✅ 메모 추가 -->
    <insert id="insertMemo" useGeneratedKeys="true" keyProperty="memoNo">
        INSERT INTO CALENDAR_MEMO (USER_NO, CONTENT)
        VALUES (#{userNo}, #{content})
    </insert>

    <!-- ✅ 메모 수정 -->
    <update id="updateMemo">
        UPDATE CALENDAR_MEMO
        SET CONTENT = #{content}
        WHERE MEMO_NO = #{memoNo}
    </update>

</mapper>
